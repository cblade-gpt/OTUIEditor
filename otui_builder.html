<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTUI Builder v3.5.7</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <link rel="stylesheet" href="otui_builder.css">
</head>
<body>
    <div class="app">
        <header class="app-header">
            <div class="header-left"><div class="logo"><span class="logo-icon">OTUI</span><span>Builder v3.5.7</span></div></div>
            <div class="header-right">
                <button class="btn btn-secondary" id="settingsBtn" title="Settings">⚙ Settings</button>
                <button class="btn btn-secondary" id="newBtn">New</button>
                <button class="btn btn-accent" id="exportBtn">Export Module</button>
            </div>
        </header>

        <div class="app-body">
            <aside class="sidebar sidebar-left">
                <div class="sidebar-header"><h2>Widgets</h2></div>
                <div class="sidebar-content"><div id="widgetPalette"></div></div>
            </aside>

            <main class="workspace">
                <div class="workspace-toolbar">
                    <button class="btn btn-sm" id="undoBtn" title="Undo (Ctrl+Z)">Undo</button>
                    <button class="btn btn-sm" id="redoBtn" title="Redo (Ctrl+Y)">Redo</button>
                    <div class="toolbar-separator"></div>
                    <button class="btn btn-sm" id="deleteBtn" title="Delete (Del)">Delete</button>
                    <button class="btn btn-sm" id="copyBtn" title="Copy (Ctrl+C)">Copy</button>
                    <button class="btn btn-sm" id="pasteBtn" title="Paste (Ctrl+V)">Paste</button>
                    <button class="btn btn-sm" id="duplicateBtn" title="Duplicate (Ctrl+D)">Duplicate</button>
                    <div class="toolbar-separator"></div>
                    <button class="btn btn-sm" id="gridToggleBtn">Grid</button>
                    <button class="btn btn-sm" id="snapToggleBtn">Snap</button>
                    <div class="toolbar-separator"></div>
                    <button class="btn btn-sm" id="zoomOutBtn">-</button>
                    <span class="zoom-level" id="zoomLevel">100%</span>
                    <button class="btn btn-sm" id="zoomInBtn">+</button>
                    <button class="btn btn-sm" id="zoomResetBtn" title="Reset Zoom">Reset</button>
                    <div class="toolbar-separator"></div>
                    <button class="btn btn-sm btn-accent" id="previewBtn" title="Preview in OTCv8">Preview</button>
                </div>
                <div class="canvas-wrapper">
                    <div class="editor-viewport">
                        <div class="editor-grid" id="editorGrid"></div>
                        <div class="editor-content" id="editorContent"></div>
                    </div>
                </div>
            </main>

            <aside class="sidebar sidebar-right">
                <div class="sidebar-header">
                    <h2>Properties & Code</h2>
                    <div id="editingIndicator" style="display:none;">Editing: <span id="editingWidgetType"></span></div>
                </div>
                <div class="sidebar-content">
                    <div class="panel">
                        <div class="panel-header"><h3>Properties</h3><div class="panel-badge" id="selectedWidgetBadge">None</div></div>
                        <div class="panel-content" id="propertyForm"><div class="no-selection-message">Select a widget</div></div>
                    </div>
                    <div class="panel">
                        <div class="panel-header"><h3>Hierarchy</h3></div>
                        <div class="panel-content" id="hierarchyTree"></div>
                    </div>
                    <div class="panel">
                        <div class="panel-header"><h3>Code</h3></div>
                        <div class="panel-content">
                            <button class="btn btn-accent" id="viewCodeBtn" style="width: 100%;">View Code</button>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <footer class="app-footer">
            <div>Widgets: <span id="widgetCount">0</span></div>
        </footer>
    </div>

    <div id="moduleCreatorModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header"><h2>Export Module</h2><button class="modal-close" aria-label="Close">×</button></div>
            <div class="modal-body">
                <div class="form-group"><label>Name:</label><input id="moduleName" value="main" placeholder="Module name (e.g., main)"></div>
                <div class="form-group"><label>Title:</label><input id="moduleTitle" value="My Module" placeholder="Module title"></div>
                <div class="form-group"><label>Description:</label><input id="moduleDescription" value="" placeholder="Module description"></div>
                <div class="form-group"><label>Author:</label><input id="moduleAuthor" value="" placeholder="Author name"></div>
                <div class="form-group"><label>Website:</label><input id="moduleWebsite" value="" placeholder="Website URL (optional)"></div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="moduleSandboxed" checked style="width: auto;">
                        <span>Sandboxed</span>
                    </label>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="moduleAutoload" checked style="width: auto;">
                        <span>Autoload</span>
                    </label>
                </div>
                <button class="btn btn-accent" id="exportAllBtn" style="width: 100%; margin-top: 10px;">Export ZIP</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <div id="previewModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 95vw; width: 1200px; height: 90vh;">
            <div class="modal-header">
                <h2>OTCv8 Preview</h2>
                <button class="modal-close" aria-label="Close">×</button>
            </div>
            <div class="modal-body" style="padding: 0; height: calc(90vh - 80px); overflow: hidden; background: #000000;">
                <div id="otcv8Preview" style="width: 100%; height: 100%; position: relative; background: #000000; display: flex; align-items: center; justify-content: center; overflow: auto; padding: 20px;">
                    <div id="previewWindow" style="position: relative; background: #000000; min-width: 800px; min-height: 600px; margin: auto; border: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="codeModal" class="modal" style="display:none;">
        <div class="modal-content code-modal-content">
            <div class="modal-header">
                <h2>Generated Code</h2>
                <button class="modal-close" aria-label="Close">×</button>
            </div>
            <div class="modal-body code-modal-body">
                <div class="code-tabs">
                    <button class="code-tab active" data-tab="otui">OTUI</button>
                    <button class="code-tab" data-tab="lua">LUA</button>
                    <button class="code-tab" data-tab="otmod">OTMOD</button>
                </div>
                <div class="code-modal-content-wrapper">
                    <pre id="otuiCode" class="code-block language-otui active" style="display: block;"><code></code></pre>
                    <pre id="luaCode" class="code-block language-lua" style="display: none;"><code></code></pre>
                    <pre id="otmodCode" class="code-block language-otmod" style="display: none;"><code></code></pre>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" aria-label="Close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Step 1: Load .otui Style Files</label>
                    <input type="file" id="otuiFilesInput" multiple accept=".otui" style="width: 100%; padding: 8px; margin-top: 4px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-primary); border-radius: 4px; cursor: pointer;">
                    <small style="color: #94a3b8; display: block; margin-top: 6px;">
                        Select all .otui files from your <code>data/styles</code> folder (Ctrl+A or Ctrl+Click to select multiple).
                    </small>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Step 2: Load Images Folder</label>
                    <input type="file" id="imagesFilesInput" multiple accept="image/*" webkitdirectory directory style="width: 100%; padding: 8px; margin-top: 4px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-primary); border-radius: 4px; cursor: pointer;">
                    <small style="color: #94a3b8; display: block; margin-top: 6px;">
                        Select your <code>data/images</code> folder (or all image files). This ensures UI objects display correctly with images.
                    </small>
                </div>
                <div id="settingsStatus" style="margin-top: 10px; padding: 8px; border-radius: 4px; display: none;"></div>
            </div>
        </div>
    </div>

    <script src="otui_builder.js"></script>
</body>
</html>